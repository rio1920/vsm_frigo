<!DOCTYPE html>
{% load static %}
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Constancia de Entrega</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      font-size: 13px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
    }
    th, td {
      border: 1px solid #000;
      padding: 6px;
      text-align: center;
      vertical-align: middle;
      border-collapse: collapse;
    }
    th {
      background-color: #f2f2f2;
    }
    .no-border td {
      border: none;
      text-align: left;
    }
    .header {
      font-weight: bold;
      text-align: center;
      padding: 10px;
      font-size: 14px;
    }
    .firma {
      height: 60px;
    }


  </style>
</head>

<div style="display: flex; justify-content: space-around; align-items: center; margin-top: 1rem; width: 15%;">
    <div>
        <a href="{% url 'registros' %}" class="m-10"><button class="btn btn-primary m-6">< Volver</button></a>
    </div>
    <div>
        <a href="" class="m-10"><button class="btn btn-success m-6" onclick="printSection('pdf-content')"><i class="bi bi-printer"></i> Imprimir</button></a>
    </div>
</div>

    <div class="container" style="padding: 0%; margin: 2rem auto 2rem auto;" id="pdf-content">
        <table>
            <tr>
                <td>
                    <img src="{% static 'images/logo.svg' %}" alt="Logo Frigo" width="160">
                </td>
            <td>
                CONSTANCIA DE ENTREGA DE ROPA DE TRABAJO Y ELEMENTOS DE PROTECCIÓN PERSONAL
            </td>
            </tr>
        </table>

        <table>
            <tr>
            <td><b>RAZÓN SOCIAL:</b> {{ vsm.retirante.razon_social }} </td>
            <td><b>CUIT:</b> {{ vsm.retirante.cuil }} </td>
            <td><b>DIRECCIÓN:</b> Av. De los CONSTITUYENTES 2499</td>
            <td><b>LOCALIDAD:</b> PACHECO</td>
            </tr>
            <tr>
            <td><b>CP:</b> 1617</td>
            <td colspan="2"><b>NOMBRE Y APELLIDO DEL TRABAJADOR:</b> {{ vsm.retirante.nombre }} {{ vsm.retirante.apellido }}</td>
            <td><b>DNI:</b> {{ vsm.retirante.dni }}</td>
            </tr>
            <tr>
            <td><b>LEGAJO:</b> {{ vsm.retirante.legajo }}</td>
            <td colspan="3"><b>PERFIL DE RIESGO (DESCRIPCIÓN):</b> {{ vsm.retirante.perfil_riesgo }}</td>
            </tr>
        </table>

        <p style="font-size: 12px; margin: 0px 0; border-top: none; border-bottom: none; border-left: #000 1px solid; border-right: #000 1px solid; padding: 5px; text-align: justify;">
            ELEMENTOS DE PROTECCIÓN NECESARIOS PARA EL TRABAJADOR, SEGÚN EL PUESTO:<br>
            SUPERINTENDENCIA DE RIESGOS DE TRABAJO. RESOLUCIÓN 299/2011. ADÓPTENSE LAS REGLAMENTACIONES QUE PROCUREN LA PROVISIÓN DE ELEMENTOS DE PROTECCIÓN PERSONAL
        </p>

        <table>
            <thead>
            <tr>
                <th>PRODUCTO</th>
                <th>TIPO/MODELO</th>
                <th>MARCA</th>
                <th>POSEE CERTIFICACIÓN SI/NO</th>
                <th>CANTIDAD</th>
                <th>FECHA DE ENTREGA</th>
                <th>FIRMA DEL TRABAJADOR</th>
                <th>OBSERVACIONES</th>
            </tr>
            </thead>
            <tbody>
            {% for producto in vsm.vsmproducto_set.all %}
            <tr>
                <td>{{ producto.producto.descripcion }}</td>
                <td>{{ producto.producto.descripcion }}</td>
                <td>{{ producto.marca }}</td>
                <td>SI</td>
                <td>{{ producto.cantidad_entregada }}</td>
                <td>{{ vsm.fecha_entrega|date:"d-m-Y" }}</td>
                {% if vsm.estado == 'entregado' %}
                <td style="font-weight: bolder;"><img src="{{ producto.firma_retirante.url }}" alt="Firma"
                 width="80" height="80"></td>
                {% else %}
                <td style="font-weight: bolder;"></td>
                {% endif %}
                <td></td>
            </tr>
            {% endfor %}
            <tr><td colspan="8">&nbsp;</td></tr>
            </tbody>
        </table>
        <!-- Disposiciones -->
        <p style="font-size: 12px; margin: 0px 0; border-top: none; border-bottom: none; border-left: #000 1px solid; border-right: #000 1px solid; padding: 5px; text-align: justify;">
            De la Ley 19587 de Higiene y Seguridad en el Trabajo Art. 10: El trabajador estará obligado a:<br>
            Cumplir con las normas de Higiene y Seguridad y con las recomendaciones que se le formulen referentes a las obligaciones de uso, conservación y cuidado del equipo de protección personal y de las propias maquinarias y procesos de trabajo. Dec. 351/79 Cap. 19 Art. 188 al 203<br>
            <b>Disposiciones de la empresa:</b><br>
            El elemento de protección personal que se le entregara será de “uso obligatorio”, siendo responsabilidad del trabajador mantenerlo en buen estado. Todo defecto rotura o deterioro del mismo deberá ser comunicado de inmediato, para proceder a su reemplazo.<br>
            Corresponderá apercibimiento en caso de encontrarse al operario trabajando sin sus elementos de protección personal.
        </p>

        <table>
            <tr>
            <td class="firma" style="width: 80%; text-align: right;">
                <!-- Firma trabajador -->
            </td>
            <td style="width: 20%; text-align: center;">
                <b>FUI NOTIFICADO</b><hr>
                {% if vsm.estado == 'entregado' %}
                    {% with vsm.vsmproducto_set.all|first as primer_producto %}
                        {% if primer_producto and primer_producto.firma_retirante %}
                            <span>
                                <img src="{{ primer_producto.firma_retirante.url }}" 
                                    alt="Firma" 
                                    width="80" 
                                    height="80">
                            </span>
                        {% endif %}
                    {% endwith %}
                {% else %}
                    {% endif %}
                <!-- Firma notificación -->
            </td>
            </tr>
        </table>
    </div>
<script>
function printSection(sectionId) {
  const section = document.getElementById(sectionId).innerHTML;
  const printWindow = window.open('', '', 'width=800,height=600');
  printWindow.document.write(`
    <html>
      <head>
        <title>Imprimir</title>
        <style>
          body {
            font-family: Arial, sans-serif;
            font-size: 13px;
          }
          table {
            border-collapse: collapse;
            width: 100%;
          }
          th, td {
            border: 1px solid #000;
            padding: 6px;
            text-align: center;
            vertical-align: middle;
            border-collapse: collapse;
          }
          th {
            background-color: #f2f2f2;
          }
          .no-border td {
            border: none;
            text-align: left;
          }
          .header {
            font-weight: bold;
            text-align: center;
            padding: 10px;
            font-size: 14px;
          }
          .firma {
            height: 60px;
          }


        </style>
      </head>
      <body>
        ${section}
      </body>
    </html>
  `);
  printWindow.document.close();
  printWindow.focus();
  printWindow.print();
  printWindow.close();
}
</script>

</html>